<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <style>
      body {
        font-family: sans-serif;
        background-color: hsl(85, 100%, 3%);
        padding: 40px;
      }
      .container {
        border: 5px solid rgba(1, 92, 61, 0.514);
        max-width: 600px;
        background: white;
        padding: 24px;
        border-radius: 12px;
        display: flex;
        gap: 40px;
      }

      .left {
        flex: 1;
      }
      .right {
        flex: 1;
      }

      h1 {
        margin: 0;
      }

      h2 {
        margin-top: 32px;
        border-bottom: 2px solid #ffffff;
      }

      p {
        line-height: 1.6;
      }
    </style>
  </head>

  <body>
    <!-- TODO:ここからHTML -->
    <div class="container">
      <div class="left">
        <!-- TODO:文章の書き方 -->
        <section>
          <h1>hello Would</h1>
          <h2>よろしく 世界</h2>

          <p>START Here</p>
          <p>ここから始まる</p>
        </section>

        <!-- TODO:hはタイトル、数は大きさ、ｐが文 -->
        <section>
          <h2>my name is S</h2>
          <h3>俺の名前はS</h3>
          <p>I am studying IT</p>
          <p>俺はITを学んでいる</p>
        </section>

        <section>
          <!-- TODO:liは「・」 -->
          <h2>I will be rich people</h2>
          <h3>俺は金持ちになるつもり</h3>
          <ul>
            <li>to cleate website</li>
            <li>plograming</li>
          </ul>
        </section>

        <!-- TODO:上からのボタン -->
        <button id="btnAlert">押してみ</button>

        <p id="msg">まだ何も起きてないね</p>
        <!-- TODO:切り替えのボタン -->
        <button id="btnToggle">切り替え</button>

        <!--TODO:入力ボタン-->
        <input id="nameInput" type="text" placeholder="名前を入力" />
        <button id="btnSubmit">送信</button>

        <p id="output">まだ未入力</p>

        <!-- TODO:カウントボタン　-->
        <p id="counter">0</p>
        <button id="btn">カウント</button>

        <!-- リセットボタン-->
        <button id="resetBtn">リセット</button>
      </div>

      <!-- TODO:入力リスト　-->
      <div class="right">
        <ul id="nameList"></ul>
      </div>
    </div>

    <script>
      // ======表示系===== //
      function showMessage(text, color) {
        const output = document.getElementById("output");
        output.textContent = text;
        output.style.color = color;
      }

      // =====重複確認===== //
      function isDuplicate(value) {
        const items = document.querySelectorAll("#nameList li");
        for (const li of items) {
          if (li.dataset.name === value) {
            return true;
          }
        }
        return false;
      }

      // ======リスト追加===== //
      function addToList(value) {
        const list = document.getElementById("nameList");
        const li = document.createElement("li");

        li.dataset.name = value;

        const span = document.createElement("span");
        span.textContent = value;

        // 表示を「さん付け」
        span.textContent = `${value}さん`;

        const editBtn = document.createElement("button");
        editBtn.textContent = "編集";
        editBtn.style.marginLeft = "10px";

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "x";
        deleteBtn.style.marginLeft = "20px";

        // =====文字数制限===== //
        const maxLength = 7;
        if (value.length > maxLength) {
          showMessage("長すぎます", "red");
          return;
        }

        // 編集処理
        editBtn.onclick = function () {
          const input = document.getElementById("nameInput");
          input.value = li.dataset.name;
          //　編集確定処理
          document.getElementById("btnSubmit").onclick = function () {
            const newValue = input.value.trim();

            if (newValue === "") {
              showMessage("Please input name", "red");
              return;
            }

            li.dataset.name = newValue;
            span.textContent = `${newValue}さん`;

            showMessage("Update", "green");
            saveList();
            input.value = "";

            // 元の送信処理に戻す
            resetSubmit();
          };
        };

        //　削除処理
        deleteBtn.onclick = function () {
          li.remove();
          count = 0;
          document.getElementById("counter").textContent = count;
          saveList();
        };

        li.appendChild(span);
        li.appendChild(editBtn);
        li.appendChild(deleteBtn);
        list.appendChild(li);
        saveList();
      }

      // TODO:上からのボタン
      document.getElementById("btnAlert").onclick = function () {
        alert("ここからがIT人生の始まり");
      };

      //　TODO:切り替えボタン
      let isChanged = false;
      document.getElementById("btnToggle").onclick = function () {
        if (isChanged) {
          document.getElementById("msg").textContent = "変更";
        } else {
          document.getElementById("msg").textContent = "まだ何も起きてないね";
        }
        isChanged = !isChanged;
      };

      //　TODO:入力ボタン
      function resetSubmit() {
        document.getElementById("btnSubmit").onclick = function () {
          const input = document.getElementById("nameInput");
          const value = input.value.trim();

          // 空確認
          if (value === "") {
            showMessage("Please input name", "red");
            return;
          }

          // 重複確認
          if (isDuplicate(value)) {
            showMessage("既に使用されています", "red");
            return;
          }

          // OK時
          showMessage("OK", "green");
          addToList(value);
          input.value = "";
        };
      }

      //　TODO:ENTERキー送信
      document
        .getElementById("nameInput")
        .addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            document.getElementById("btnSubmit").click();
          }
        });

      //　カウント
      let count = 0;

      document.getElementById("btn").onclick = function () {
        count++;
        document.getElementById("counter").textContent = count;
      };

      //　リセット
      document.getElementById("resetBtn").onclick = function () {
        count = 0;
        document.getElementById("counter").textContent = count;
      };

      // ローカル保存
      function saveList() {
        const items = document.querySelectorAll("#nameList li");
        const values = [];

        for (const li of items) {
          values.push(li.dataset.name);
        }

        localStorage.setItem("nameList", JSON.stringify(values));
      }

      //　ローカル保存を呼び出す
      function loadList() {
        const saved = localStorage.getItem("nameList");
        if (!saved) return;

        const values = JSON.parse(saved);

        for (const value of values) {
          addToList(value);
        }
      }
      loadList();
      resetSubmit();
    </script>
  </body>
</html>
